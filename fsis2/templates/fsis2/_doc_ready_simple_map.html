<script type="text/javascript">

{% load geojson_tags %}

 $(document).ready(function(){

     // we will initialize the map over lake huron - this could be customized at some point in the future.
     var  my_map = new L.map('main_map').setView([45,-82], 7);

     var events = {{ object.event_set.all|geojsonfeature:"popup_text"|safe }};

     function onEachFeature(feature, layer) {
         if (feature.properties && feature.properties.popup_text) {
             layer.bindPopup(feature.properties.popup_text);
         }
     };

     L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ', {
         maxZoom: 18,
         attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                      '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                      'Imagery  <a href="http://mapbox.com">Mapbox</a>',
         id: 'mapbox.streets'
     }).addTo(my_map);


     var points = L.geoJson(events, {
         style: {color: "#FF3399", fillColor:"#FF99CC"},
         pointToLayer: function(feature, latlng) {
             return new L.CircleMarker(latlng, {radius: 5, fillOpacity: 0.75});
         },
         onEachFeature: onEachFeature})

         points.addTo(my_map);

 });

</script>
